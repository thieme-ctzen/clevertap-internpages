<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CleverTap - Use Case Finder (MVP)</title>
  <style>
    :root{
      --bg-page: #133B58;
      --bg-deep: #0D2A40;
      --card-bg: #FFFFFF;
      --text-on-bg: #FFFFFF;
      --text-on-card: #133B58;
      --accent: #F04444;
      --border-card: #D0D7DF;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.25);
      --radius-card: 18px;
      --focus-ring: 0 0 0 3px rgba(240, 68, 68, 0.35);
      --transition-fast: 0.22s ease-out;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body{
      min-height: 100vh;
      background: linear-gradient(180deg, var(--bg-page) 0%, var(--bg-deep) 100%);
      color: var(--text-on-bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 32px 16px;
      display: flex;
      justify-content: center;
    }
    .page-wrapper{ max-width: 1120px; width: 100%; position: relative; padding-top: 8px; }
    .top-actions{
      position: absolute; top: 0; left: 0; right: 0;
      display: flex; justify-content: space-between; align-items: center;
      gap: 10px; z-index: 10; flex-wrap: wrap;
    }
    .left-actions,.right-actions{ display: inline-flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .home-btn{
      border-radius: 999px; border: 1px solid rgba(255,255,255,0.6);
      background: rgba(0,0,0,0.15); color: #fff;
      height: 34px; padding: 0 12px; font-size: 13px;
      cursor: pointer; text-decoration: none; backdrop-filter: blur(4px);
      transition: background var(--transition-fast), transform 0.15s, box-shadow 0.18s, border-color 0.18s;
      white-space: nowrap;
    }
    .home-btn:hover{ background: rgba(0,0,0,0.3); border-color: #fff; transform: translateY(-1px); box-shadow: 0 10px 25px rgba(0,0,0,0.35); }
    .home-btn:focus-visible{ outline: none; box-shadow: var(--focus-ring); }
    .pill{
      display: inline-flex; align-items: center;
      border-radius: 999px; padding: 6px 10px;
      border: 1px solid rgba(255,255,255,0.55);
      background: rgba(0,0,0,0.18); font-size: 12px;
      color: rgba(255,255,255,0.92); white-space: nowrap;
    }
    .lang-wrap{
      display: inline-flex; gap: 8px;
      background: rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.55);
      border-radius: 999px; padding: 4px; backdrop-filter: blur(4px);
    }
    .lang-btn{
      border: none; background: transparent; color: rgba(255,255,255,0.92);
      font-size: 12px; padding: 6px 10px; border-radius: 999px;
      cursor: pointer; transition: background var(--transition-fast), color var(--transition-fast);
    }
    .lang-btn:hover{ background: rgba(255,255,255,0.12); color: #fff; }
    .lang-btn.active{ background: rgba(255,255,255,0.22); color: #fff; font-weight: 700; }
    .lang-btn:focus-visible{ outline: none; box-shadow: var(--focus-ring); }

    .header{ text-align: center; margin-bottom: 18px; padding-top: 54px; }
    .title{ font-size: clamp(26px, 4vw, 34px); font-weight: 700; margin-bottom: 10px; letter-spacing: -0.02em; }
    .subtitle{ font-size: 14px; opacity: 0.88; max-width: 860px; margin: 0 auto; line-height: 1.55; }

    .shell{
      margin-top: 18px; background: rgba(255,255,255,0.06);
      border-radius: 20px; padding: 18px; box-shadow: 0 20px 40px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    .prompt-card{
      background: var(--card-bg); color: var(--text-on-card);
      border: 1px solid var(--border-card); border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft); padding: 16px; position: relative; overflow: hidden;
    }
    .prompt-card::before{
      content:""; position:absolute; inset:0;
      background: radial-gradient(circle at top left, rgba(240,68,68,0.10), transparent 55%);
      pointer-events:none;
    }
    .prompt-top{
      display:flex; justify-content: space-between; align-items:flex-start;
      gap:12px; flex-wrap: wrap; position: relative; z-index: 1;
    }
    .prompt-title{ font-weight: 700; font-size: 16px; }
    .prompt-hint{ font-size: 12px; opacity: 0.78; line-height: 1.5; margin-top: 6px; max-width: 760px; }
    textarea{
      width:100%; min-height: 118px; margin-top: 12px;
      border-radius: 14px; border: 1px solid #D0D7DF;
      padding: 12px; font-size: 13px; line-height: 1.5;
      resize: vertical; outline: none; position: relative; z-index: 1;
    }
    textarea:focus-visible{ border-color: rgba(240,68,68,0.85); box-shadow: var(--focus-ring); }
    .tag-row{
      margin-top:12px; display:flex; justify-content: space-between; align-items:center;
      gap:12px; flex-wrap: wrap; position: relative; z-index: 1;
    }
    .tag-box{ display:flex; gap:8px; flex-wrap: wrap; align-items:center; }
    .tag-chip{
      border: 1px solid rgba(19,59,88,0.25); background: rgba(19,59,88,0.07);
      color: var(--text-on-card); border-radius: 999px; padding: 6px 10px; font-size: 12px;
      cursor:pointer; transition: transform 0.12s, background var(--transition-fast), border-color var(--transition-fast);
      user-select:none; white-space: nowrap;
    }
    .tag-chip:hover{ transform: translateY(-1px); border-color: rgba(240,68,68,0.55); background: rgba(240,68,68,0.06); }
    .tag-chip.selected{ border-color: rgba(240,68,68,0.85); background: rgba(240,68,68,0.10); color: #0F172A; font-weight: 650; }

    .actions{ display:flex; gap:10px; flex-wrap: wrap; justify-content: flex-end; }
    .btn{
      border-radius: 999px; border: 1px solid rgba(19,59,88,0.25);
      background: rgba(19,59,88,0.07); color: #133B58;
      font-size: 13px; padding: 9px 14px; cursor: pointer;
      transition: transform 0.15s, box-shadow 0.18s, background var(--transition-fast), border-color var(--transition-fast);
      font-weight: 650; white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 25px rgba(0,0,0,0.18); }
    .btn:focus-visible{ outline: none; box-shadow: var(--focus-ring); }
    .btn.primary{ border-color: rgba(240,68,68,0.95); background: rgba(240,68,68,0.10); color: #0F172A; }
    .btn.primary:hover{ background: rgba(240,68,68,0.16); }
    .btn.danger{ border-color: rgba(239,68,68,0.45); background: rgba(239,68,68,0.06); color: #7F1D1D; }

    .results-header{ display:flex; justify-content: space-between; align-items:center; gap:12px; flex-wrap: wrap; margin-top: 18px; margin-bottom: 10px; }
    .results-title{ font-weight: 700; font-size: 14px; }
    .results-meta{ font-size: 12px; opacity: 0.85; }

    .empty{
      margin-top: 12px; font-size: 12px; opacity: 0.9; line-height: 1.6;
      background: rgba(0,0,0,0.18); border: 1px dashed rgba(255,255,255,0.35);
      border-radius: 16px; padding: 14px;
    }

    .results-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; }
    .result-card{
  background: var(--card-bg);
  color: var(--text-on-card);
  border: 1px solid var(--border-card);
  border-radius: var(--radius-card);
  box-shadow: var(--shadow-soft);
  padding: 16px;
  position: relative;
  overflow: hidden;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}
.result-card::before{
  content:"";
  position:absolute;
  inset:0;
  background: radial-gradient(circle at top left, rgba(240,68,68,0.08), transparent 60%);
  pointer-events:none;
}
.result-card:hover{
  transform: translateY(-8px);
  box-shadow: 0 22px 38px rgba(0,0,0,0.35);
}

/* Top header becomes vertical so logo can be larger */
.result-top{
  display: flex;
  flex-direction: column;
  gap: 12px;
  position: relative;
  z-index: 1;
  margin-bottom: 10px;
}

/* Bigger logo area */
.logo{
  width: 100%;
  height: 90px;                /* bigger */
  border-radius: 14px;
  border: 1px solid rgba(19,59,88,0.14);
  background: rgba(19,59,88,0.03); /* subtle frame; works with transparent png */
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.logo img{
  width: 100%;
  height: 100%;
  object-fit: contain;          /* preserve transparency */
  background: transparent;      /* important */
  padding: 10px;                /* keeps nice margins inside logo area */
}

/* Text block below logo */
.client{
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
  width: 100%;
  min-width: 0;
}
.proj{
  min-width: 0;
  flex: 1;
}

/* Bigger titles */
.proj-name{
  font-weight: 900;
  font-size: 17px;             /* bigger */
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.client-name{
  font-size: 13.5px;           /* bigger */
  opacity: 0.82;
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Score pill aligned to the right */
.score{
  align-self: flex-end;
  border-radius: 999px;
  padding: 7px 10px;
  font-size: 12px;
  border: 1px solid rgba(240,68,68,0.55);
  background: rgba(240,68,68,0.08);
  color: #0F172A;
  font-weight: 700;
}

/* Sections text slightly larger overall */
.section p, .section ul{
  font-size: 13px;
  line-height: 1.6;
  opacity: 0.92;
}
.section h4{
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  opacity: 0.7;
  margin-bottom: 6px;
}


    .mini-tags{ display:flex; flex-wrap: wrap; gap:8px; margin-top: 10px; }
    .mini-tag{ border-radius: 999px; padding: 5px 9px; font-size: 11px; border: 1px solid rgba(19,59,88,0.22); background: rgba(19,59,88,0.06); opacity:0.95; }

    @media (max-width: 768px){
      body { padding: 24px 12px; }
      .header { padding-top: 78px; }
      .shell { padding: 16px; }
    }

    /* Rich results list */
.kpi-list{
  list-style: none;
  padding-left: 0;
  margin: 0;
  display: grid;
  gap: 8px;
}
.kpi-item{
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-size: 13.5px;     /* bigger */
  font-weight: 650;
  line-height: 1.35;
}
.kpi-arrow{
  color: #16A34A;        /* green */
  font-weight: 900;
  line-height: 1;
  transform: translateY(1px);
}
.kpi-text{
  opacity: 0.95;
}

  </style>
</head>
<body>
  <main class="page-wrapper">
    <div class="top-actions">
      <div class="left-actions">
        <a class="home-btn" href="index.html" data-i18n="top.home">Home</a>
        <span class="pill" data-i18n="top.pill">Use Case Finder (MVP)</span>
      </div>
      <div class="right-actions">
        <div class="lang-wrap">
          <button class="lang-btn active" type="button" data-lang="pt">PT</button>
          <button class="lang-btn" type="button" data-lang="en">EN</button>
          <button class="lang-btn" type="button" data-lang="es">ES</button>
        </div>
      </div>
    </div>

    <header class="header">
      <h1 class="title" data-i18n="header.title">Casos de Uso por Indústria</h1>
      <p class="subtitle" data-i18n="header.subtitle">
        MVP com busca local: tags e palavras. Digite seu pedido e use tags no formato #tag para guiar a busca.
      </p>
    </header>

    <section class="shell">
      <div class="prompt-card">
        <div class="prompt-top">
          <div>
            <div class="prompt-title" data-i18n="prompt.title">Descreva seu cenário</div>
            <p class="prompt-hint" data-i18n="prompt.hint">
              Exemplo: “Preciso de um caso de uso para #fintech focado em #onboarding”.
            </p>
          </div>
          <span class="pill" data-i18n="prompt.badge">Busca local (JSON)</span>
        </div>

        <textarea id="promptInput"></textarea>

        <div class="tag-row">
          <div>
            <div style="font-size:12px; opacity:0.78; margin-bottom:8px;" data-i18n="tags.title">
              Sugestões rápidas (clique para inserir):
            </div>
            <div class="tag-box" id="suggestedTags">
              <span class="tag-chip" data-tag="#fintech">#fintech</span>
              <span class="tag-chip" data-tag="#retail">#retail</span>
              <span class="tag-chip" data-tag="#food">#food</span>
              <span class="tag-chip" data-tag="#onboarding">#onboarding</span>
              <span class="tag-chip" data-tag="#reactivation">#reactivation</span>
              <span class="tag-chip" data-tag="#promotions">#promotions</span>
              <span class="tag-chip" data-tag="#email">#email</span>
              <span class="tag-chip" data-tag="#push">#push</span>
              <span class="tag-chip" data-tag="#whatsapp">#whatsapp</span>
            </div>
          </div>

          <div class="actions">
            <button class="btn danger" id="clearBtn" type="button" data-i18n="buttons.clear">Limpar</button>
            <button class="btn primary" id="searchBtn" type="button" data-i18n="buttons.search">Buscar</button>
          </div>
        </div>
      </div>

      <div class="results-header">
        <div class="results-title" data-i18n="results.title">Resultados</div>
        <div class="results-meta" id="resultsMeta" data-i18n="results.none">Nenhuma busca ainda.</div>
      </div>

      <div id="emptyState" class="empty" data-i18n="results.tip">
        Dica: use tags e palavras. Ex.: “onboarding fintech” + #fintech #onboarding.
      </div>

      <div class="results-grid" id="resultsGrid"></div>
    </section>
  </main>

  <script>
    // ---------------- i18n ----------------
    const I18N = {
      pt: {
        'top.home': 'Home',
        'top.pill': 'Use Case Finder (MVP)',
        'header.title': 'Casos de Uso por Indústria',
        'header.subtitle': 'MVP com busca local: tags e palavras. Digite seu pedido e use tags no formato #tag para guiar a busca.',
        'prompt.title': 'Descreva seu cenário',
        'prompt.hint': 'Exemplo: “Preciso de um caso de uso para #fintech focado em #onboarding”.',
        'prompt.badge': 'Busca local (JSON)',
        'tags.title': 'Sugestões rápidas (clique para inserir):',
        'buttons.clear': 'Limpar',
        'buttons.search': 'Buscar',
        'results.title': 'Resultados',
        'results.none': 'Nenhuma busca ainda.',
        'results.tip': 'Dica: use tags e palavras. Ex.: “onboarding fintech” + #fintech #onboarding.',
        'errors.empty': 'Digite um pedido para buscar.',
        'sec.description': 'Descrição',
        'sec.pains': 'Dores mapeadas',
        'sec.value': 'Como a CleverTap trouxe valor',
        'sec.results': 'Resultados',
        'label.score': 'Score',
        'label.scoreTitle': 'Relevância local (tags + palavras)',
        'placeholder': 'Digite aqui seu pedido. Ex.: Preciso de um caso de uso para #fintech focado em #onboarding.'
      },
      en: {
        'top.home': 'Home',
        'top.pill': 'Use Case Finder (MVP)',
        'header.title': 'Use Cases by Industry',
        'header.subtitle': 'MVP with local search: tags and keywords. Type your request and use #tags to guide the search.',
        'prompt.title': 'Describe your scenario',
        'prompt.hint': 'Example: “I need a use case for #fintech focused on #onboarding”.',
        'prompt.badge': 'Local search (JSON)',
        'tags.title': 'Quick suggestions (click to insert):',
        'buttons.clear': 'Clear',
        'buttons.search': 'Search',
        'results.title': 'Results',
        'results.none': 'No search yet.',
        'results.tip': 'Tip: use tags and keywords. Example: “fintech onboarding” + #fintech #onboarding.',
        'errors.empty': 'Type a request to search.',
        'sec.description': 'Description',
        'sec.pains': 'Pain points',
        'sec.value': 'How CleverTap delivered value',
        'sec.results': 'Outcomes',
        'label.score': 'Score',
        'label.scoreTitle': 'Local relevance (tags + keywords)',
        'placeholder': 'Type your request. Example: I need a use case for #fintech focused on #onboarding.'
      },
      es: {
        'top.home': 'Home',
        'top.pill': 'Use Case Finder (MVP)',
        'header.title': 'Casos de Uso por Industria',
        'header.subtitle': 'MVP con búsqueda local: tags y palabras clave. Escribe tu pedido y usa #tags para guiar la búsqueda.',
        'prompt.title': 'Describe tu escenario',
        'prompt.hint': 'Ejemplo: “Necesito un caso de uso para #fintech enfocado en #onboarding”.',
        'prompt.badge': 'Búsqueda local (JSON)',
        'tags.title': 'Sugerencias rápidas (clic para insertar):',
        'buttons.clear': 'Limpiar',
        'buttons.search': 'Buscar',
        'results.title': 'Resultados',
        'results.none': 'Aún no hay búsqueda.',
        'results.tip': 'Tip: usa tags y palabras. Ejemplo: “onboarding fintech” + #fintech #onboarding.',
        'errors.empty': 'Escribe un pedido para buscar.',
        'sec.description': 'Descripción',
        'sec.pains': 'Dolores identificados',
        'sec.value': 'Cómo CleverTap aportó valor',
        'sec.results': 'Resultados',
        'label.score': 'Score',
        'label.scoreTitle': 'Relevancia local (tags + palabras)',
        'placeholder': 'Escribe tu pedido. Ej.: Necesito un caso de uso para #fintech enfocado en #onboarding.'
      }
    };

    let currentLang = 'pt';
    function t(key){ return (I18N[currentLang] && I18N[currentLang][key]) || I18N.pt[key] || key; }
    function applyI18n(){
      document.documentElement.lang = currentLang === 'pt' ? 'pt-BR' : (currentLang === 'es' ? 'es' : 'en');
      document.querySelectorAll('[data-i18n]').forEach(el => el.textContent = t(el.getAttribute('data-i18n')));
      promptInput.placeholder = t('placeholder');
    }

    // ---------------- Elements ----------------
    const promptInput = document.getElementById('promptInput');
    const suggestedTags = document.getElementById('suggestedTags');
    const clearBtn = document.getElementById('clearBtn');
    const searchBtn = document.getElementById('searchBtn');
    const resultsGrid = document.getElementById('resultsGrid');
    const resultsMeta = document.getElementById('resultsMeta');
    const emptyState = document.getElementById('emptyState');

    // ---------------- Data load ----------------
    let USECASES = [];
    async function loadUseCases(){
      // cache-busting for GitHub Pages
      const url = './data/usecases.json?v=' + Date.now();
      const res = await fetch(url);
      const data = await res.json();
      USECASES = data.items || [];
    }

    // ---------------- Helpers ----------------
    function extractTags(text){
      const matches = text.match(/#[a-zA-Z0-9_-]+/g) || [];
      return Array.from(new Set(matches.map(tg => tg.toLowerCase())));
    }
    function insertTag(tag){
      const tg = tag.toLowerCase();
      const current = promptInput.value || '';
      const has = extractTags(current).includes(tg);
      if (has) return;
      const needsSpace = current.length && !current.endsWith(' ') ? ' ' : '';
      promptInput.value = current + needsSpace + tg + ' ';
      promptInput.focus();
      syncSelectedTagChips();
    }
    function syncSelectedTagChips(){
      const tags = extractTags(promptInput.value);
      document.querySelectorAll('.tag-chip').forEach(chip => {
        const tg = chip.dataset.tag.toLowerCase();
        chip.classList.toggle('selected', tags.includes(tg));
      });
    }
    function escapeHtml(str){
      return String(str || '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function pickLang(value){
      if (value === null || value === undefined) return '';
      if (typeof value === 'string' || typeof value === 'number') return String(value);
      if (typeof value === 'object'){
        return value[currentLang] || value.pt || value.en || value.es || '';
      }
      return String(value);
    }
    function pickArray(value){
      if (!value) return [];
      if (Array.isArray(value)) return value;
      if (typeof value === 'object'){
        const v = value[currentLang] || value.pt || value.en || value.es;
        return Array.isArray(v) ? v : [];
      }
      return [];
    }

    // ---------------- Local scoring ----------------
    function scoreCase(item, queryText, queryTags){
      const hay = [
        pickLang(item.projectName),
        pickLang(item.clientName),
        pickLang(item.description),
        pickLang(item.clevertapValue),
        pickArray(item.pains).join(' '),
        pickArray(item.results).join(' '),
        (item.tags || []).join(' '),
        item.industry || '',
        item.region || '',
        item.country || ''
      ].join(' ').toLowerCase();

      const words = queryText
        .toLowerCase()
        .replace(/#[a-z0-9_-]+/g,' ')  // remove tags from word scoring
        .replace(/[^a-z0-9áàâãéèêíïóôõöúçñ\s-]/gi,' ')
        .split(/\s+/)
        .filter(w => w && w.length >= 3);

      let score = 0;

      // tags weight
      const itemTags = (item.tags || []).map(tg => String(tg).toLowerCase());
      queryTags.forEach(tg => { if (itemTags.includes(tg)) score += 8; });

      // industry quick match
      if (queryTags.includes('#fintech') && item.industry === 'fintech') score += 4;
      if (queryTags.includes('#retail') && item.industry === 'retail') score += 4;
      if (queryTags.includes('#food') && item.industry === 'food') score += 4;

      // keyword hits
      words.forEach(w => {
        if (hay.includes(w)) score += 1.2;
      });

      return score;
    }

    // ---------------- Render ----------------
    function render(items){
      resultsGrid.innerHTML = '';
      if (!items.length){
        emptyState.style.display = 'block';
        resultsMeta.textContent = '0';
        return;
      }
      emptyState.style.display = 'none';
      resultsMeta.textContent = String(items.length);

      items.forEach(item => {
        const clientName = pickLang(item.clientName) || 'Client';
        const projectName = pickLang(item.projectName) || 'Project';
        const description = pickLang(item.description) || '';
        const value = pickLang(item.clevertapValue) || '';
        const pains = pickArray(item.pains);
        const results = pickArray(item.results);
        const tags = item.tags || [];
        const logoUrl = item.clientLogoUrl || '';

        const logoHtml = logoUrl
          ? `<img src="${escapeHtml(logoUrl)}" alt="Client logo">`
          : `<span aria-hidden="true">${escapeHtml((clientName || 'C')[0].toUpperCase())}</span>`;

        const card = document.createElement('article');
        card.className = 'result-card';
card.innerHTML = `
  <div class="result-top">
    <div class="logo">${logoHtml}</div>

    <div class="client">
      <div class="proj">
        <div class="proj-name" title="${escapeHtml(projectName)}">${escapeHtml(projectName)}</div>
        <div class="client-name" title="${escapeHtml(clientName)}">${escapeHtml(clientName)}</div>
      </div>
      <div class="score" title="${escapeHtml(t('label.scoreTitle'))}">
        ${escapeHtml(t('label.score'))}: ${escapeHtml(String(item._score.toFixed(1)))}
      </div>
    </div>
  </div>

  <div class="section">
    <h4>${escapeHtml(t('sec.description'))}</h4>
    <p>${escapeHtml(description)}</p>
  </div>

  <div class="section">
    <h4>${escapeHtml(t('sec.pains'))}</h4>
    ${pains.length ? `<ul>${pains.map(p => `<li>${escapeHtml(p)}</li>`).join('')}</ul>` : `<p>—</p>`}
  </div>

  <div class="section">
    <h4>${escapeHtml(t('sec.value'))}</h4>
    <p>${escapeHtml(value)}</p>
  </div>

  <div class="section">
    <h4>${escapeHtml(t('sec.results'))}</h4>
    ${
      results.length
        ? `<ul class="kpi-list">
            ${results.map(r => `
              <li class="kpi-item">
                <span class="kpi-arrow">→</span>
                <span class="kpi-text">${escapeHtml(r)}</span>
              </li>
            `).join('')}
          </ul>`
        : `<p>—</p>`
    }
  </div>

  ${tags.length ? `<div class="mini-tags">${tags.map(tg => `<span class="mini-tag">${escapeHtml(tg)}</span>`).join('')}</div>` : ``}
`;

        resultsGrid.appendChild(card);
      });
    }

    // ---------------- Actions ----------------
    suggestedTags.addEventListener('click', (e) => {
      const chip = e.target.closest('.tag-chip');
      if (!chip) return;
      insertTag(chip.dataset.tag);
    });

    promptInput.addEventListener('input', syncSelectedTagChips);

    clearBtn.addEventListener('click', () => {
      promptInput.value = '';
      resultsGrid.innerHTML = '';
      resultsMeta.textContent = t('results.none');
      emptyState.style.display = 'block';
      syncSelectedTagChips();
      promptInput.focus();
    });

    searchBtn.addEventListener('click', () => {
      const q = (promptInput.value || '').trim();
      if (!q){
        resultsMeta.textContent = t('errors.empty');
        emptyState.style.display = 'block';
        return;
      }

      const qTags = extractTags(q);
      const scored = USECASES
        .map(item => {
          const s = scoreCase(item, q, qTags);
          return { ...item, _score: s };
        })
        .filter(x => x._score > 0)
        .sort((a,b) => b._score - a._score)
        .slice(0, 6);

      render(scored);
    });

    // Lang switch
    function setLang(lang){
      currentLang = lang;
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));
      applyI18n();
      // Se já tem resultados, re-renderiza no idioma novo
      const existing = Array.from(resultsGrid.children).length > 0;
      if (existing) {
        // Recalcula score (opcional) e re-renderiza
        const q = (promptInput.value || '').trim();
        const qTags = extractTags(q);
        const scored = USECASES
          .map(item => ({ ...item, _score: scoreCase(item, q, qTags) }))
          .filter(x => x._score > 0)
          .sort((a,b) => b._score - a._score)
          .slice(0, 6);
        render(scored);
      }
    }
    document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', () => setLang(btn.dataset.lang)));

    // init
    (async function init(){
      applyI18n();
      syncSelectedTagChips();
      try{
        await loadUseCases();
      } catch (e){
        resultsMeta.textContent = 'Error loading JSON';
        emptyState.style.display = 'block';
        emptyState.textContent = 'Could not load data/usecases.json. Check file path and GitHub Pages publish.';
      }
    })();
  </script>
</body>
</html>
